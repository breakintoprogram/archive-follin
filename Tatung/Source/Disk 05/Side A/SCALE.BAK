ORG 60000
LOAD 49152

DI
LD A,1
LD (L0+1),A
LD HL,TABLE
L0:LD A,(HL)
AND A
JP Z,BASIC
CHAN:LD A,000
INC A
LD (CHAN+1),A
CP 3
JP NZ,M1
LD A,1
LD (CHAN+1),A
M1:DEC A
JR NZ,M2
LD D,A
LD (SMD+1),A
SRL A
SRL A
LD (SDD+1),A
INC HL
JP M4
M2:DEC A
JR NZ,M3
LD E,A
LD (SME+1),A
SRL A
SRL A
LD (SEE+1),A
INC HL
JP M4
M3:DEC A
JR NZ,M4
LD C,A
LD (SMC+1),A
SRL A
SRL A
LD (SCC+1),A
INC HL
M4:LD B,(HL)
INC HL
;
LD B,6
;
L1:DEC D
JP NZ,L2
SMD:LD D,000
XOR A
OUT (254),A
SDD:LD A,000
SD1:DEC A
JP NZ,SD1
LD A,16
OUT (254),A
SSD:LD A,000
SD2:DEC A
JP NZ,SD2
L2:DEC E
JP NZ,L3
SME:LD E,000
XOR A
OUT (254),A
SEE:LD A,000
SE1:DEC A
JP NZ,SE1
LD A,16
OUT (254),A
SSE:LD A,000
SE2:DEC A
JP NZ,SE2
L3:DEC C
JP NZ,L4
SMC:LD C,000
XOR A
OUT (254),A
SCC:LD A,000
SC1:DEC A
JP NZ,SC1
LD A,16
OUT (254),A
SSC:LD A,000
SC2:DEC A
JP NZ,SC2
L4:LD A,000
DEC A
AND 7
LD (L4+1),A
JP NZ,L1
LD A,(SDD+1)
DEC A
JR NZ,L5
LD (SDD+1),A
LD A,(SSD+1),A
INC A
LD (SSD+1),A
L5:LD A,(SEE+1)
DEC A
JR NZ,L6
LD (SEE+1),A
LD A,(SSE+1),A
INC A
LD (SSE+1),A
L6:LD A,(SCC+1)
DEC A
JR NZ,L6
LD (SCC+1),A
LD A,(SSC+1),A
INC A
LD (SSC+1),A
DJNZ L1
JP L0

BASIC:EI
RET

TABLE:DB 254,240,226,214,201,190
DB 180,170,160,151,142,135
DB 127,120,113,107,100,95
DB 90,85,80,76,71,67,63,60
DB 57,53,49,255
END
